以下のように無向グラフGを考えます。
頂点集合:1以上 N以下の整数
辺集合:各 1<=j<=Mに対して、(xj,yj)という辺を張る
すると次のことが示せます
S := {i|Gにおいてiとpiが同じ連結成分にある}とおくと、最終状態で全ての i ∈ S
に対して同時に Pi=i とすることができる。
証明は後に回します。逆にGにおいてiとpiが異なる連結成分に属してしまっている
場合、操作を行っても pi=i とできない事は明らかです。従って、|S| が答えになります。
各 i が S に属するかは UnionFind 等を使うと求めることができます。

証明:気持ち的には同じ連結成分内では好きに値を入れ替えられることからわかります。ちゃんと
やると、各連結成分 C に対して、 C から {pi|i∈C}への全単射fであったi∈Sならf(i)=i
となるようなものがとれて、連結成分の全域木をとって、ひとつの葉iに正しい値 f(i) を
置くということを繰り返せば示せます。
