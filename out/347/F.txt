
		公式
		
			
				F - Non-overlapping Squares 解説
			
			by MMNMM
			
		
		
		
		
			次の事実を示します。


平面 \(\mathbb R ^ 2\) 上に、辺と軸とが平行で互いに共有点をもたない（境界を含まない）正方形が \(3\) つある。
このとき、ある軸と平行な直線 \(l\) が存在し、次の条件が成り立つ。


\(l\) はどの正方形とも共有点をもたない
\(l\) によって分割された \(2\) つの領域のどちらにも、\(1\) つ以上の正方形が含まれる



証明

一方の軸を選び、\(3\) つの正方形をその軸上の開区間へそれぞれ射影します（軸上のある点が区間に含まれる \(\iff\) その点を通り軸と垂直な直線が正方形と共有点を持つ）。

区間を頂点とし、区間が共通部分をもつとき、かつそのときに限り \(2\) つの区間に辺を張ったグラフを考えます。

これが非連結であるとき、選んだ軸に垂直な直線であって条件を満たすものが存在します（連結成分ごとに合併を取って \(1\) つの開区間にし、右端が最小のものの右端を取ることで具体的に取れます）。

これが連結であるとき、連結性より辺の数は \(2\) 以上なので、鳩の巣原理より次数が \(2\) の頂点が存在します。
この頂点に対応する正方形は今見ている軸方向に残り \(2\) つの正方形と共通部分を持つので、もう一方の軸方向にはどちらの正方形とも共通部分を持ちません。よって、この正方形の上端もしくは下端と一致するような直線のうち少なくとも一方が条件を満たします。



よって、選んだ \(3\) つの \(M\times M\) のマス目についても、次のどちらかが成り立ちます。


ある \(k\ (M\leq k\leq N-M)\) が存在し、\((i,j)\ (i\leq k)\) の部分と \((i,j)\ (k\lt i)\) の部分のどちらにも \(1\) つ以上の正方形が含まれ、境界にまたがる正方形は存在しない
ある \(k\ (M\leq k\leq N-M)\) が存在し、\((i,j)\ (j\leq k)\) の部分と \((i,j)\ (k\lt j)\) の部分のどちらにも \(1\) つ以上の正方形が含まれ、境界にまたがる正方形は存在しない


また、\(2\) つの正方形が含まれる部分についても同様に考えると、最適な \(M\times M\) のマス目の取り方に関して、\(N\times N\) のマス目を \(3\) つに分割する以下の図の \(6\) 通りのいずれかの方法について、それぞれの領域に正方形が \(1\) つずつ含まれます（図中の長さの比は自由に動きます。ここでいう分割する方法は、どちらの軸に平行な線分がどのような位置関係にあるかのみで区別されます）。



これらの \(6\) 通りそれぞれについて、その形としてありえる総和の最大値を求められれば、それらの最大値が答えになります。
複数の形に合致する \(M\times M\) のマス目の取り方がある場合がありますが、最大値を求めているため問題ありません。

例えば次の \(2\) つの方針でこの問題を解くことができます。


それぞれの分割方法に対し、線の位置 \(O(N ^ 2)\) 通りを全探索し、それぞれの部分に含まれる \(M\times M\) マスの和としてありえる最大値を求める。
\(2\) つの線で区切られている領域に入る正方形を固定し、たかだか \(10\) 通りについて残りの領域の最大値を計算する。


それぞれの方針で、長方形領域に含まれるような正方形のうち合計が最大のものを求める必要があります。
この部分もいくつか方針が考えられます。


\(2\) 次元セグメント木や \(2\) 次元 Sparse Table などを用いる。全体で \(O((N\log N) ^ 2)\) 時間などで答えを求めることができます。
必要となる値が限られた形で書けるので、事前に \(O(N ^ 2)\) 時間かけてこれらの値をすべて求めておくことで \(1\) 回あたり \(O(1)\) 時間となり、全体で \(O(N ^ 2)\) で答えを求められます。


\(6\) 通りの分割方法を上の図における左 \(2\) つと右 \(4\) つの \(2\) 種類に分け、それぞれ ad-hoc に求めることもできます。

実装例は以下のようになります。
\(2\) つめの方針による解法です。



		
		
			
				投稿日時:
				
				
			
				
				最終更新:
				
				
			
			
		
	
