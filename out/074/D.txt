都市を頂点、道路を辺としてグラフ理論の言葉で説明します。
条件を満たすグラフが存在するとき、任意の頂点 u, v について、これら
の間には辺がないか、長さ Au,v の辺があるかのどちらかとなります。なぜ
なら、

• u, v の間に Au,v よりも長い辺があった場合、この辺は取り除いても最
短距離に影響を与えず、

• u, v の間に Au,v よりも短い辺があった場合、u, v 間の最短距離は明
らかに Au,v よりも短くなる
からです。
グラフ G を任意の u, v の間に長さ Au,v の辺を張ったグラフとします。上
の考察より、G の部分グラフに関してのみ考えればよいことになります。
どの頂点間に辺を張る必要があるか考えます。

A (の対角線上以外の要素) のうち Au,v が最小値であるとき、A が最短距
離を表す表であるようなグラフには u と v を長さ Au,v で結ぶ辺が必要です。
なぜなら、そうでないとすると他の頂点 w を経由して頂点 u から頂点 v ま
で距離 Au,v で移動できる必要がありますが、そのとき頂点 u と頂点 w の距
離は Au,v よりも小さくなるからです。
同様に G のすべての辺について短い方から見ていくことで、求めるべきグ
ラフは以下のとおりであることがわかります (G から辺 {u, b} を取り除いた
グラフを G\{u, v} と書いています)。

• ある u, v について、G\{u, v} における uv 最短距離が Au,v 未満であ
るとき、条件を満たすグラフは存在しない。
• そうでないとき、G\{u, v} における uv 最短距離が Au,v より大きいよ
うな u, v に限り辺を張ったグラフが求めるべきグラフである。
G\{u, v} における uv 最短路の長さを A′u,v と書くことにします。A′u,v と
Au,v の大小を比較するために、まず G における全点対最短距離を WarshallFloyd 法を用いて求め、その値を B とします。
Bu,v < Au,v となる u, v が存在するとき、この u, v について、A′u,v = Bu,v
< Au,v となります。よって条件を満たすグラフは存在しません。
あとは、任意の u, v について Au,v = Bu,v であったとして、A′u,v が Au,v と
等しいか、それより大きいかを判定できればよいことになります。A′u,v = Au,v
であることは、以下と同値です。

∃w, u ̸= w, v ̸= w, Bu,v = Bu,w + Bw,v

3

(1)

実際、A′u,v = Au,v のとき、w として G\{u, v} における uv 最短路上の頂
点をとれます。逆に、上のような w が取れるとき、G における w を通った

uv 最短路は G\{u, v} における uv 最短路にもなっています。
よって、条件を満たすグラフが存在するとき、答えは条件 (1) を満たす u, v
について Au,v (= A′u,v = Bu,v ) の和をとったものになります。

N をグラフの頂点の数とするとき、B を求めるための Warshall-Floyd 法
の計算量は O(N 3 ) です。また、条件 (1) は各 u, v について O(N ) で確かめ
られるので、全体の計算量は O(N 3 ) です。以上から、アルゴリズム全体の
計算量は O(N 3 ) となるので、十分高速です。

