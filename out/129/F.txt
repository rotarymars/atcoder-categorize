F. Takahashi’s Basics in Education and Learning
問題を次のように言い換えます．

• 文字列 X と 整数 s を持つ．はじめ，X = ”0”, s = A である．
• 1 回の操作では，X の末尾に s が連結された後，s が B 増える．
• N 回操作した後の X mod M はいくらか．
d 桁の要素の個数を Cd とすると，99
. . . 9} 以下の要素の個数から 99
. . . 9} 以下の要素の個数を引くことで，Cd は容易に求ま
| {z
| {z
d

d−1

ります．d 桁の要素 Cd 個を X の末尾に連結する操作は，(X, s) 7→ (X × 10d + s, s + B) という操作を Cd 回繰り返すことと
同値です．そして，この操作は以下のように行列の積の形に落とし込めます．



10d

1
(X, s, 1)
0

0
1
B


0
0 = (X × 10d + s, s + B, 1)
1

(1)

したがって，この 3 × 3 行列の Cd 乗が高速に求まればよく，繰り返し二乗法によって O(log Cd ) で結果が求まります．
上の計算を d = 1, 2, . . . , 18 についてこの順に行えば，最終的な X mod M の値が高速に求まります．オーバーフローに十分
注意してください．
