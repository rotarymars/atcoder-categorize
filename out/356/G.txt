
		公式
		
			
				G - Freestyle 解説
			
			by physics0523
			
		
		
		
		
			まず、高橋くんの泳ぎ方が以下の \(2\) 種類しかなかった場合を考えてみましょう。


\(1\) 秒あたり体力を \(A_1\) 消費して \(B_1\) [m] 進む
\(1\) 秒あたり体力を \(A_2\) 消費して \(B_2\) [m] 進む


このとき、高橋くんはこれらを組み合わせることで次のような泳ぎ方をすることができます。


\(1\) 秒あたり体力を \(tA_1+(1-t)A_2\) 消費して \(tB_1+(1-t)B_2\) [m] 進む


つまり、 \(B\) を \(x\) 軸、 \(A\) を \(y\) 軸に対応させて \((B_1,A_1), (B_2,A_2)\) にプロットすると、これらを結ぶ直線上の任意の点に対応する泳ぎ方ができることになります。

では、点の数を増やしてみるとどうなるでしょうか？

実は、高橋くんが \(N\) 点 \((B_i,A_i)\) に対応する泳ぎ方をすることができるとき、高橋くんはこれら \(N\) 点の凸包の内部または周上の任意の点に対応する泳ぎ方をすることができ、これ以外の泳ぎ方をすることはできません。

略証: まず、直線の場合の議論より凸包の周上の任意の点が作れることがわかります。凸包の内部の任意の点も、凸包の周上の2点を選んでそれらを結ぶ直線で凸包の内部を塗りつぶすように構成できます。
逆に、もし凸包の外部の点が作れたとすると、最初から凸包の外部に点が存在することになってしまい矛盾します。

泳ぎ方を \(xy\) 平面上にプロットして考察を続けます。


\(x\) 座標が最も大きい ( \(B_i\) が最も大きい) 点を 時間効率が最も良い点 と呼ぶことにします。常にその点に対応する泳ぎ方ができる (そのようにしても体力が持つ) ならば、そうするのが最適です。
\(A_i / B_i\) が最も小さい点を 体力効率が最も良い点 と呼ぶことにします。常にその点に対応する泳ぎ方をしても \(D_i\) [m] 泳ぎ切ることができないならば、どのようにしても \(D_i\) [m] 泳ぐことはできないので答えは -1 です。


例えば、サンプルでは、時間効率が最も良い点 \(P_\omega\) は \((B,A) = (4,4)\) 、体力効率が最も良い点 \(P_\alpha\) は \((B,A)=(2,1)\) です。

以降、体力効率が最も良い点で \(D_i\) [m] 泳ぎ切ることができ、時間効率が最も良い点では \(D_i\) [m] 泳ぎ切れないものとします。

この状況の下で、体力 \(C_i\) 以内で \(D_i\) [m] を泳ぎ切らなければなりません。この情報を \(xy\) 平面に書き加えましょう。
具体的には、 \((0,0),(D_i,C_i)\) を通る線を書き込みます。この直線上またはそれより下側にある点であれば、どの点に対応する泳ぎ方をしても体力 \(C_i\) 以下で \(D_i\) [m] を泳ぐことができます。逆に、この直線より上側にあるどの点に対応する泳ぎ方をしても \(D_i\) [m] を泳ぎ切ることはできません。

このもとで、求めるべきは \(D_i\) [m] を泳ぎ切れる中で最も秒速が速い (図中では最も右にある) 点です。そして、そのような点は凸包の外周と直線との交点のうち \(x\) 座標が最大のものです。

(下図はサンプルの \(5\) 個目のクエリを図示したものです)


実際にそのような点を (考察を最小限にして) 求めたいならば、 凸多角形と直線の交点を求めるライブラリ が役立ちます。
今回は少し考察して実装を軽くする方法を示します。

体力効率が最も良い点 \(P_\alpha\) で泳ぎ切れて時間効率が最も良い点 \(P_\omega\) では泳ぎ切れないことを利用して、凸包のうち \(P_\alpha\) から \(P_\omega\) を反時計回りに回ることを考えます。
このとき、 \(P_\alpha\) から交点 \(P_{opt}\) までは泳ぎ切れて、 \(P_{opt}\) から \(P_\omega\) までは泳ぎ切れないという状態になります。
よって、まず \(P_{opt}\) が凸包上のどの直線上にあるかを二分探索し、その後 \(P_{opt}\) が当該の直線上のどこにあるかを二分探索すると \(P_{opt}\) の場所を求めることができます。

実装例 (C++):



		
		
			
				投稿日時:
				
				
			
				
				最終更新:
				
				
			
			
		
	
