1. 問題概要
2. リアクティブについて
3. アルゴリズム

2015/2/28

©AtCoder Inc. All rights reserved.

15


• N頂点からなる重み付き根なし無向木がある．
• Nが与えられ，以下の質問を何回かできる
– 頂点aと頂点bの間の距離を尋ねる

• 木の直径を答えよ．
• 制約
– 2<=N<=50
– 20点: 質問回数<=1300
– 80点: 質問回数<=100

2015/2/28

16


• この問題はリアクティブ形式の問題です．
– 滅多にみないかもしれませんが KUPC・IOI などではよく出
ます
– デバッグが少し大変になりがちです(基本的に手元では返
答を手で行う必要があるので)
• たくさん問題があるコンテストで実装の重いリアクティブは後回し
にするのも手


• 20点解法では，単純にすべての2頂点のペアについ
て，その間の距離を尋ね，最大値が直径となる．
• 頂点a と頂点bの間の距離と頂点bと頂点aの間の距
離が同じなので，a<b なもののみ聞けばよい．
• 質問回数はN*(N-1)/2<=1300


• 最大ケースだと，満点解法では2N回以下の質問回
数で直径を求めなければならない．
• 辺を特定するのは現実的ではなさそう
– ある頂点から一番近い頂点へは直接辺でつながっている
と分かるが，N-1回の質問で最悪1つの辺しか見つけられ
ない

• 辺を特定することなく直径だけ求める方法をうまいこ
と考えたい/探したい．


• 木の直径を求める方法の1つに double-sweepという
方法があります．
• 木の頂点から任意の1つの頂点から一番離れた頂
点をvとすると，vから最も離れた点までの距離が直
径になる，というもの．
• 何故か？
• (以後2つの頂点a,bの間の距離を a--b と書きます)


• まず，任意の1つの頂点を根と決める． そこから最も離
れている頂点のうち1つを v とおく．v を片方の頂点とし
て持つ，距離が直径のペアがあることを示したい．
• 背理法を使う．v と v から最も離れた点への距離より長
い頂点の組をa,b とおく．
• aとbのLCA（最近共通祖先，Lとおく）が根とvの間にある
とき
– 右の2つの図のいずれかの

根

根

形を取る(L=根となることもある)

– どちらの場合でも，
v--b は a--b より
短くなることはない．
∵ v はLから最も離
れた頂点のうちの1
つであることに注目

v

L

L

a

b

v

a

b


• aとbのLCA（最近共通祖先，Lとおく）が根とvの間にない
とき
– LとvのLCAをL2とおくと，右下のような図になる．
– この場合では，v--bの間の距離はa--bの距離より長い
• v はLから最も離れた頂点のうちの1つなので，
L2--v >= L2--L +L--a
• よって，
v--b=L2--v+L2--L+L--b>=2*L2--L+L--a+L--b
>L--a+L--b>=a--b

根
L2
L

v

a

b


• よって，任意に1つの頂点を取った時に，そこから最
も離れた頂点のうち1つを使って直径が取れること
が分かった．
• この問題なら，頂点1から他のすべての頂点への距
離を尋ねて最も遠い頂点を求め，そこからさらに他
のすべての頂点への距離を尋ね，その最大値が答
え．質問回数は 2*N-2

• 木の直径を求める時はこの知識を知らなくても大丈
夫だが，知ってると役に立つときは他にもあったりし
ます．


