まず高橋君が最大の利益を上げるためにどのように行動すればよいかを考える。高橋君が町 i でリンゴを
売ったとき、そのリンゴは町 i よりも前にある町で、最もリンゴの値が安いところで買ったとしてよい。つま
り、高橋君は町 i でリンゴを売るとき Ai − min{A1 , ..., Ai−1 } 円の利益をあげられると考えることができる。
この値を新たに Bi とおく。すると、ひとつの町で売買するリンゴの数に制限はないので、Bi が最大となる
ような町でできるだけ多くのリンゴを売ることで収益を最大化することができる。
高橋君の収益を減らすという目的を達成するためには、Bi の最大値を少なくとも 1 減らす必要が
ある。いま、町 x でリンゴを売るときの収益 Bx がすべての町のなかで最大であるとしよう。Bx は

Ax − min{A1 , ..., Ax−1 } であるが、Ai の値が相異なるという制約からこの式の min の中で最小となるもの
はただひとつ存在し、Bx = Ax − Ay と書ける。この y を x のペアと呼ぶことにする。Bx の値を減らすため
には、Ax を 1 減らすか、ペアである Ay を 1 増やすかのどちらかを行えばよく、これはコスト 1 で行える。
一般に Bi の値が最大となるような町 i は複数個あるかもしれないが、やはり Ai の値が相異なるという制
約から、Bx と Bx′ がともに最大であるとき x ̸= x′ ならそれぞれのペアである y, y ′ も異なることがわかる。
したがって、最大値が複数個あるときも互いに影響を及ぼすことなく、それぞれコスト 1 で Bx の値を減ら
していくことになる。
よって求めるべき答えは Bx が最大となるような x の個数となる。これは Ai を順に見ていき、今まで見
た値の最小値を管理しておけば全体で O(N ) 時間で求めることができる。

