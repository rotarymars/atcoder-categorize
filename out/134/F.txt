簡単のため、問題を以下のように言い換えます。

うさぎ 1, うさぎ 2, ..., うさぎ N と、かめ 1, かめ 2, ..., かめ N がいる。うさぎとかめのペアを N 組
作る方法のうち、ペアになったうさぎの添字とかめの添字の差の和 (これを「奇妙さ」と呼ぶ) が K に
なるものはいくつあるか。

結論から言うと、以下のように状態を定義することで、解を動的計画法で求めることができます。

• dp[i][j][k][l] = うさぎ 1, ..., うさぎ i, かめ 1, ..., かめ i までを見て、ペアにするのを保留にしている
(かめ i + 1 以降とペアにする ) うさぎの数がj、ペアにするのを保留にしている (うさぎi+1以降とペア
にする) かめの数が k 、確定している奇妙さが l であるときの場合の数。
ここで確定している奇妙さとは、たとえばうさぎ i をかめ i + 1 以降とペアにする場合、少なくとも 1 の奇
妙さが確定する、といったことを意味します。ところで、ペアを保留にしているうさぎの数とかめの数は一致
します。よって DP テーブルの二次元目と三次元目は 1 つにまとめることができます。このとき DP の遷移
は以下のように書けます。

• dp[i][j][k] = (2∗j+1)∗dp[i−1][j][k−2∗j]+(j+1)∗(j+1)∗dp[i−1][j+1][k−2∗j]+dp[i−1][j−1][k−2∗j]
ここで右辺の第 1 項は、うさぎ i とかめ i をペアにする場合および、うさぎ i とかめ i のいずれかを保留
にしておいた動物とペアにする場合を表します (ペアを保留にしている動物の数だけ、確定している奇妙さが
増えます)。右辺の第 2 項は、うさぎ i とかめ i の両方を保留にしておいた動物とペアにする場合を表します。
そして右辺の第 3 項は、うさぎ i とかめ i のどちらもペアにするのを保留する場合を表しています。
この動的計画法は状態数が O(N 4 )、遷移が O(1) なので、全体で O(N 4 ) の計算量で解を求めることがで
きます。
