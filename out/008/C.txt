コイン

©AtCoder Inc. All rights reserved.

15

• N 枚のコインを無作為に一列に並べます。
• 左端から順に、そのコインよりも右側にある、そのコ
インに書かれた数の倍数が書かれたコインをすべ

てひっくり返す動作をします。
• 最終的に表を向いている(偶数回反転した)コインの
枚数の期待値を計算してください。
• 1 ≦ N ≦ 100
©AtCoder Inc. All rights reserved.

16

•

この問題では浮動小数点が出てきます。

•

文字列同様、浮動小数点の扱いにも慣れておきま
しょう。

•

整数型と浮動小数点型間の移行などの際には注
意してください。

©AtCoder Inc. All rights reserved.

17

•

N ! 通りのすべての組み合わせを作り、実際に実験
してみようと考えます。

•

N ≦ 8 であれば、計算量が O(N!) でも大丈夫なこ
とが多いです（今回も、この方針で 99 点を得ること
ができます）。

•

残り 1 点を得るには N ≦ 100 の制約に対処する
必要があります。
©AtCoder Inc. All rights reserved.

18

•

もしも、N ! 通りのすべての組み合わせを N=100 に
おいて計算しようとなると、それにはとてつもない時
間がかかることになります(2 sec の時間制限は大
幅に超えてしまう)。

•

より高速に動作するアルゴリズムを設計する必要

があります。

©AtCoder Inc. All rights reserved.

19

•

期待値の性質を用いることで高速に解くためのア
プローチが得られます。

•

求める期待値は、すべての組み合わせのうちそれ
ぞれにおいて表を向いているコインの枚数の総合
計を N! で割ったものとして計算できます。

•

コインの枚数の総合計について考えます。

©AtCoder Inc. All rights reserved.

20

•

コインの枚数の総合計は、組み合わせごとに区
切って数えても、各コインが全組み合わせのうち何
通りの組み合わせで表を向くのかという数え方で数
えても一致します。

•

よって、それぞれのコインについて、そのコインが、

何通りの並べ方で表を向くのかという方針で計算
することにします。
©AtCoder Inc. All rights reserved.

21

•

補足として、全体を足しあわせてから N! で割った
結果と、それぞれの要素を N! で割ったものの合計
は等しくなります。

•

それぞれのコインごとに、表を向いている組み合わ
せ数を N! で割った値は、そのコインが表を無いた

状態で終了する確率に等しくなります。
•

今回の場合、この確率の足し合わせが期待値にな
ります。
©AtCoder Inc. All rights reserved.

22

•

あるコインについて、このコインに書かれた数を C
としたとき、どのような条件を満たせばこのコインが
最終的に表を向いているかを考えます。

•

このコインよりも左側にあるコインに書かれた数の
うち、C の約数となっているものの枚数が奇数枚な

ら裏、偶数枚なら表となります。

©AtCoder Inc. All rights reserved.

23

•

全コインのうち、目標のコインと、それ以外の中で C の約数
となっているコイン(S 枚あるとする)の並びについて考えま
す。

他

約
数

他

約
数

©AtCoder Inc. All rights reserved.

目
標

約
数

24

•

全コインのうち、目標のコインと、それ以外の中で C の約数
となっているコイン(S 枚あるとする)の並びについて考えま
す。

•

C の約数でないコインの並びは関係なく、純粋に目標のコ
インより左に何個 C の約数があるかを考えます。

他

約
数

他

約
数

©AtCoder Inc. All rights reserved.

目
標

約
数

25

•

目標のコインについて、そのコインが左から何番目にあった
としても、C の約数内では S! 通りの並べ方があります。

•

つまり、左から 1 番目、2 番目、… (S+1) 番目のいずれも

当確率で出てくることになります。
•

より左側に偶数枚ということは、左から奇数枚目にある確率
が、目標のコインが表を向いている確率に等しくなります。
約
数

約
数

約
数

約
数

©AtCoder Inc. All rights reserved.

目
標

約
数

26

•

この確率は、S が奇数なら 1/2 , S が偶数なら
(S+2)/(2S+2) の確率になります。

•

それぞれのコインごとに、上記の確率を求め、足し合わせる

ことで答えが得られます。
•

計算量は O(N^2) となり、高速に答えを計算することが出来
ます。

©AtCoder Inc. All rights reserved.

27

ミュレーションする解法があります。

•

計算量は O(R×C×N!) で、この方針で 80 点を得
ることができます。

•

さらに高い点数を得るためにはこの問題について

の考察が必要になります。

©AtCoder Inc. All rights reserved.

30

