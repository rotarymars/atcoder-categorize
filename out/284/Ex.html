





<!DOCTYPE html>
<html>
<head>
	<title>解説 - AtCoder Beginner Contest 284</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Language" content="ja">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<meta name="google-site-verification" content="nXGC_JxO0yoP1qBzMnYD_xgufO6leSLw1kyNo2HZltM" />

	
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-RC512FD18N"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('set', 'user_properties', {
			
				'login_status': 'logged_out',
			
		});
		gtag('config', 'G-RC512FD18N');
	</script>

	
	<meta name="description" content="プログラミング初級者から上級者まで楽しめる、競技プログラミングコンテストサイト「AtCoder」。オンラインで毎週開催プログラミングコンテストを開催しています。競技プログラミングを用いて、客観的に自分のスキルを計ることのできるサービスです。">
	<meta name="author" content="AtCoder Inc.">

	<meta property="og:site_name" content="AtCoder">
	
	<meta property="og:title" content="解説 - AtCoder Beginner Contest 284" />
	<meta property="og:description" content="プログラミング初級者から上級者まで楽しめる、競技プログラミングコンテストサイト「AtCoder」。オンラインで毎週開催プログラミングコンテストを開催しています。競技プログラミングを用いて、客観的に自分のスキルを計ることのできるサービスです。" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://atcoder.jp/contests/abc284/editorial/5481" />
	<meta property="og:image" content="https://img.atcoder.jp/assets/atcoder.png" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@atcoder" />
	
	<meta property="twitter:title" content="解説 - AtCoder Beginner Contest 284" />

	<link href="//fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="//img.atcoder.jp/public/e5b0286/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="//img.atcoder.jp/public/e5b0286/css/base.css">
	<link rel="shortcut icon" type="image/png" href="//img.atcoder.jp/assets/favicon.png">
	<link rel="apple-touch-icon" href="//img.atcoder.jp/assets/atcoder.png">
	<script src="//img.atcoder.jp/public/e5b0286/js/lib/jquery-1.9.1.min.js"></script>
	<script src="//img.atcoder.jp/public/e5b0286/js/lib/bootstrap.min.js"></script>
	<script src="//img.atcoder.jp/public/e5b0286/js/cdn/js.cookie.min.js"></script>
	<script src="//img.atcoder.jp/public/e5b0286/js/cdn/moment.min.js"></script>
	<script src="//img.atcoder.jp/public/e5b0286/js/cdn/moment_js-ja.js"></script>
	<script>
		var LANG = "ja";
		var userScreenName = "";
		var csrfToken = "9ArhFv3q+o/hnoDGIvjudAD51rHpeNG4n9d7krnaCHs="
	</script>
	<script src="//img.atcoder.jp/public/e5b0286/js/utils.js"></script>
	
	
		<script src="//img.atcoder.jp/public/e5b0286/js/contest.js"></script>
		<link href="//img.atcoder.jp/public/e5b0286/css/contest.css" rel="stylesheet" />
		<script>
			var contestScreenName = "abc284";
			var remainingText = "残り時間";
			var countDownText = "開始まであと";
			var startTime = moment("2023-01-07T21:00:00+09:00");
			var endTime = moment("2023-01-07T22:40:00+09:00");
		</script>
		<style></style>
	
	
	
	
		<script src="//img.atcoder.jp/public/e5b0286/js/cdn/run_prettify.js"></script>
	
	
		<link rel="stylesheet" href="//img.atcoder.jp/public/e5b0286/css/cdn/katex.min.css">
		<script defer src="//img.atcoder.jp/public/e5b0286/js/cdn/katex.min.js"></script>
		<script defer src="//img.atcoder.jp/public/e5b0286/js/cdn/auto-render.min.js"></script>
		
		<script>
			var katexOptions = {
				delimiters: [
					{left: "$$", right: "$$", display: true},
					{left: "$", right: "$", display: false},
					{left: "\\(", right: "\\)", display: false},
					{left: "\\[", right: "\\]", display: true}
				],
      	ignoredTags: ["script", "noscript", "style", "textarea", "code", "option"],
				ignoredClasses: ["prettyprint", "source-code-for-copy"],
				throwOnError: false
			};
			document.addEventListener("DOMContentLoaded", function() { renderMathInElement(document.body, katexOptions);});
		</script>
	
	
		<script src="//img.atcoder.jp/public/e5b0286/js/lib/marked.js"></script>
		<script src="//img.atcoder.jp/public/e5b0286/js/cdn/jquery.timeago.min.js"></script>
		<script src="//img.atcoder.jp/public/e5b0286/js/lib/jquery.timeago.ja.js"></script>
		<script src="//img.atcoder.jp/public/e5b0286/js/blog.js"></script>
	
	
	
	
	
	
	
	
	<script src="//img.atcoder.jp/public/e5b0286/js/base.js"></script>
</head>

<body>

<script type="text/javascript">
	var __pParams = __pParams || [];
	__pParams.push({client_id: '468', c_1: 'atcodercontest', c_2: 'ClientSite'});
</script>
<script type="text/javascript" src="https://cdn.d2-apps.net/js/tr.js" async></script>


<div id="modal-contest-start" class="modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">コンテスト開始</h4>
			</div>
			<div class="modal-body">
				<p>AtCoder Beginner Contest 284が開始されました。</p>
			</div>
			<div class="modal-footer">
				
					<button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
				
			</div>
		</div>
	</div>
</div>
<div id="modal-contest-end" class="modal fade" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title">コンテスト終了</h4>
			</div>
			<div class="modal-body">
				<p>AtCoder Beginner Contest 284は終了しました。</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">閉じる</button>
			</div>
		</div>
	</div>
</div>
<div id="main-div" class="float-container">


	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
					<span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/home"></a>
			</div>
			<div class="collapse navbar-collapse" id="navbar-collapse">
				<ul class="nav navbar-nav">
				
					<li><a class="contest-title" href="/contests/abc284">AtCoder Beginner Contest 284</a></li>
				
				</ul>
				<ul class="nav navbar-nav navbar-right">
					
					<li class="dropdown">
						<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
							<img src='//img.atcoder.jp/assets/top/img/flag-lang/ja.png'> 日本語 <span class="caret"></span>
						</a>
						<ul class="dropdown-menu">
							<li><a href="/contests/abc284/editorial/5481?lang=ja"><img src='//img.atcoder.jp/assets/top/img/flag-lang/ja.png'> 日本語</a></li>
							<li><a href="/contests/abc284/editorial/5481?lang=en"><img src='//img.atcoder.jp/assets/top/img/flag-lang/en.png'> English</a></li>
						</ul>
					</li>
					
					
						<li><a href="/register?continue=https%3A%2F%2Fatcoder.jp%2Fcontests%2Fabc284%2Feditorial%2F5481">新規登録</a></li>
						<li><a href="/login?continue=https%3A%2F%2Fatcoder.jp%2Fcontests%2Fabc284%2Feditorial%2F5481">ログイン</a></li>
					
				</ul>
			</div>
		</div>
	</nav>

	<form method="POST" name="form_logout" action="/logout?continue=https%3A%2F%2Fatcoder.jp%2Fcontests%2Fabc284%2Feditorial%2F5481">
		<input type="hidden" name="csrf_token" value="9ArhFv3q&#43;o/hnoDGIvjudAD51rHpeNG4n9d7krnaCHs=" />
	</form>
	<div id="main-container" class="container"
		 	style="padding-top:50px;">
		


<div class="row">
	<div id="contest-nav-tabs" class="col-sm-12 mb-2 cnvtb-fixed">
	<div>
		<small class="contest-duration">
			
				コンテスト時間:
				<a href='http://www.timeanddate.com/worldclock/fixedtime.html?iso=20230107T2100&p1=248' target='blank'><time class='fixtime fixtime-full'>2023-01-07 21:00:00+0900</time></a> ~ <a href='http://www.timeanddate.com/worldclock/fixedtime.html?iso=20230107T2240&p1=248' target='blank'><time class='fixtime fixtime-full'>2023-01-07 22:40:00+0900</time></a> 
				(100分)
			
		</small>
		<small class="back-to-home pull-right"><a href="/home">AtCoderホームへ戻る</a></small>
	</div>
	<ul class="nav nav-tabs">
		<li><a href="/contests/abc284"><span class="glyphicon glyphicon-home" aria-hidden="true"></span> トップ</a></li>
		
			<li><a href="/contests/abc284/tasks"><span class="glyphicon glyphicon-tasks" aria-hidden="true"></span> 問題</a></li>
		

		
			<li><a href="/contests/abc284/clarifications"><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span> 質問 <span id="clar-badge" class="badge" ></span></a></li>
		

		

		
			<li>
				<a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"><span class="glyphicon glyphicon-list" aria-hidden="true"></span> 提出結果<span class="caret"></span></a>
				<ul class="dropdown-menu">
					<li><a href="/contests/abc284/submissions"><span class="glyphicon glyphicon-globe" aria-hidden="true"></span> すべての提出</a></li>
					
				</ul>
			</li>
		

		
			
				
					<li><a href="/contests/abc284/standings"><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span> 順位表</a></li>
				
			
				
					<li><a href="/contests/abc284/standings/virtual"><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span> バーチャル順位表</a></li>
				
			
		

		

		
			<li class="active"><a href="/contests/abc284/editorial"><span class="glyphicon glyphicon-book" aria-hidden="true"></span> 解説</a></li>
		
		

		<li class="pull-right"><a id="fix-cnvtb" href="javascript:void(0)"><span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span></a></li>
	</ul>
</div>
	<div class="col-sm-12">
		<span class="label label-default">公式</span>
		<h2 class="mt-1">
			
				<a href="/contests/abc284/tasks/abc284_h">Ex - Count Unlabeled Graphs</a> 解説
			
			<span class="small">by <img src="//img.atcoder.jp/assets/icon/crown_bronze.png"> <a href="/users/Nyaan" class="username"><span class="user-red">Nyaan</span></a></span>
			
		</h2>
		
		<hr class="mt-1">
		
			<div><p>まず、「ちょうど <span>\(K\)</span> 色使う」という制約を「<span>\(K\)</span> 色の中からいくつかの色を使う」という制約に替えた問題が解ければ、元の問題の答えは包除原理を利用して計算できます。<br>
よって、次の問題が解ければよいです。</p>

<blockquote>
<h5>部分問題</h5>

<p><span>\(N\)</span> 頂点の unlabeled graph(頂点ラベルなしグラフ) を 1 つ選び、各頂点に <span>\(1\)</span> から <span>\(K\)</span> までの整数のいずれかを書きこむ。得られるグラフの通り数は？</p>
</blockquote>

<p>この部分問題は unlabeled graph の部分が扱いづらいので、 labeled graph(頂点ラベルつきグラフ) を登場させると次のように読み替えられます。(ここで <span>\(S_N\)</span> は 長さ <span>\(N\)</span> の置換の集合)</p>

<blockquote>
<h5>部分問題(labeled ver.)</h5>

<p><span>\(N\)</span> 頂点の labeled graph を 1 つ選び、各頂点に <span>\(1\)</span> から <span>\(K\)</span> までの整数のいずれかを書きこむ。得られるグラフの通り数は？<br>
ただし、2 つのグラフは次の条件を満たすときに同じグラフであるとみなす。</p>

<ul>
<li>ある置換 <span>\(p \in S_N\)</span> が存在して、一方のグラフの頂点のラベルを <span>\(v_i \to v_{p_i}\)</span> にすべて同時に張り替えると、2 つのグラフの頂点の色・頂点間の辺の有無がすべて一致する。<span>\((\ast)\)</span></li>
</ul>
</blockquote>

<p>(以下では <span>\((\ast)\)</span> の条件を 「ラベルを取り除くと同型である」と呼びます)<br>
<span>\(G\)</span> を labeled graph の全体集合とします。また、labeled graph である <span>\(g\)</span> に対してグラフ <span>\(p(g)\)</span> を <span>\(g\)</span> の頂点ラベルを <span>\(v_i \to v_{p_i}\)</span> に張り替えたものとします。</p>

<p>まず、次の事実が成り立ちます。</p>

<blockquote>
<p><span>\(G\)</span> からグラフを 1 つ選び <span>\(g\)</span> とする。<span>\(A(g), B(g)\)</span> を次のように定める。</p>

<ul>
<li><span>\(A(g)\)</span> : <span>\(G\)</span> の要素のうち、ラベルを取り除くと同型であるような labeled graph の個数</li>
<li><span>\(B(g)\)</span> : <span>\(p(g)\)</span> が <span>\(g\)</span> と (labeled graph として) 同型であるような置換 <span>\(p\)</span> の個数</li>
</ul>

<p>このとき <span>\(A(g) B(g) = N!\)</span> が成り立つ。</p>
</blockquote>

<p>これは、すべての <span>\(g\)</span> とラベルを取り除くと同型なグラフ <span>\(h\)</span> に対して、<span>\(B(g)\)</span> 個の順列 <span>\(p_1, p_2, \dots, p_{B(g)}\)</span> であって <span>\(p_i(g)\)</span> が <span>\(h\)</span> と同型であるものが一対一対応することから証明できます。</p>

<p>この事実を利用すると、次の式が成り立ちます。</p>

<blockquote>
<h5>Polya の数え上げ定理(Burnside の補題,  Cauchy–Frobenius の補題とも) をこの問題に適用した式</h5>

<p><span>\(G\)</span> に含まれるグラフのラベルを取り除いた unlabeled graph の集合を <span>\(G&#39;\)</span> とする。また、置換 <span>\(p\)</span> に対して <span>\(\lbrace g \vert g \in G, p(g) = g \rbrace\)</span> を満たす <span>\(g\)</span> を不動点と呼ぶ。<br>
このとき <span>\(G&#39;\)</span> の大きさは すべての置換 <span>\(p\)</span> に対する不動点の個数の平均となる。すなわち次の式が成り立つ。</p>
<p><span>\[N! \cdot |G&#39;| = \sum_{p \in S_n}  \vert \lbrace g \vert g \in G, p(g) = g \rbrace \vert\]</span></p></blockquote>

<p>まず、左辺を変形します。<span>\(G&#39;\)</span> の要素には <span>\(G\)</span> の元から生成できるすべての unlabeled graph が 1 回ずつ登場します。unlabeled graph を 1 つ取ってきて <span>\(g&#39;\)</span> とするとラベルを取り除くと <span>\(g&#39;\)</span> になるようなグラフ <span>\(g\)</span> は <span>\(G\)</span> に <span>\(A(g)\)</span> 個含まれています。よって</p>
<p><span>\[N! \cdot |G&#39;| = N! \cdot \sum_{g \in G} \frac{1}{A(g)} = \sum_{g \in G} B(g)\]</span></p><p>と変形できます。<br>
次に右辺を二重和の形で表して <span>\(\sum\)</span> の順番を入れ替えると</p>
<p><span>\[
\begin{aligned} 
&amp;\sum_{p \in S_n} \vert \lbrace g \vert p(g) = g \rbrace \vert \\
&amp;= \sum_{p \in S_n} \sum_{g \in G} \lbrack p(g) = g \rbrack \\
&amp;= \sum_{g \in G} \sum_{p \in S_n} \lbrack p(g) = g \rbrack \\
&amp;= \sum_{g \in G}  \vert \lbrace p \vert p \in S_n, p(g) = g \rbrace \vert
\end{aligned}
\]</span></p><p>になります。(<span>\(\lbrack \mathrm{cond} \rbrack\)</span> は <span>\(\mathrm{cond}\)</span> が真ならば <span>\(1\)</span>, 偽ならば <span>\(0\)</span> を取る関数)<br>
この <span>\( \lbrace p \vert p \in S_n, p(g) = g \rbrace\)</span> はまさに <span>\(B(g)\)</span> です。よって両辺が一致することが確認できました。</p>

<p>この式を利用すると、部分問題の答えは <span>\(|G&#39;|\)</span> なので、</p>
<p><span>\[\frac{1}{N!}\sum_{p \in S_n} \vert \lbrace g \vert g \in G, p(g) = g \rbrace \vert\]</span></p><p>を計算する問題に言い換えることができました。</p>

<p>この言い換えによって「ラベルを取り除くと同型」という条件を取り除いた状態でグラフを数えることができるようになり、 数え上げる対象を簡単にすることができます。<br>
この問題のように、置換を作用させて一致すると同型になるものを 1 個として数える問題は、Polya の数え上げ定理を利用して不動点の平均に言い換えることができます。このテクニックは円環の数え上げや <a href="https://atcoder.jp/contests/abc198/tasks/abc198_f" rel="nofollow">ABC198F</a> のような立方体の数え上げで登場します。(Polya の数え上げ定理は作用させる置換の集合がよい性質を持つ時にも成り立ちます。)</p>

<p>さて、置換 <span>\(p\)</span> を固定したときに <span>\(p(g) = g\)</span> となる labeled graph の個数を数えて、それらをすべての置換に対して足し合わせて平均を取ればこの式を計算できます。置換をサイクル分解したときのサイクルの大きさの列が <span>\((c_1, c_2, \dots, c_m)\)</span> であるとき、グラフの個数は</p>
<p><span>\[K^m \times \mathrm{pow}\left(2, \sum_{i=1}^m \left(\lfloor c_i/2\rfloor + \sum_{j=1}^{i-1} \gcd(c_i, c_j)\right) \right)\]</span></p><p>になることが確認できます。よって <a href="https://atcoder.jp/contests/abc226/tasks/abc226_f" rel="nofollow">ABC226F</a> のように
自然数 <span>\(N\)</span> の分割をすべて列挙して、各分割に対して (分割がそのようになる置換の通り数) <span>\(\times\)</span> (グラフの通り数) を足し合わせればよく、これは <span>\(n\)</span> 番目の分割数を <span>\(p(n)\)</span> として <span>\(\mathrm{O}(p(N) \mathrm{poly}(N))\)</span>  で計算できて、これは十分実行時間に間に合います。</p>

<ul>
<li>適切に実装すると問題全体で <span>\(\mathrm{O}(p(N) N)\)</span> で計算できますが、制約が小さいので <span>\(\mathrm{O}(p(N) N^3)\)</span> 程度の計算量でも TL  に余裕を持って AC できると思います。<a href="https://atcoder.jp/contests/abc284/submissions/37811802" rel="nofollow">実装例</a> (<span>\(\mathrm{O}(p(N) N^3 \log N)\)</span>, 146 ms)</li>
</ul>

<p>なお、この問題の <span>\(K=1\)</span> の場合は unlabeled graph の数え上げに相当します。この問題の解法を利用すれば、 unlabeled graph の数え上げも <span>\(\mathrm{O}(p(N) N)\)</span> で計算できます。</p>
</div>
		
		<div class="clearfix">
			<p class="small gray pull-right">
				投稿日時:
				<span class="tooltip-unix" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="1672754525">
				<time class="timeago" datetime="2023/01/03 23:02:05"></time>
			</span>
				<br>
				最終更新:
				<span class="tooltip-unix" aria-hidden="true" data-toggle="tooltip" data-placement="right" title="1673522245">
				<time class="timeago" datetime="2023/01/12 20:17:25"></time>
			</span>
			</p>
		</div>
	</div>
</div>



		
			<hr>
			
			
			
<div class="a2a_kit a2a_kit_size_20 a2a_default_style pull-right" data-a2a-url="https://atcoder.jp/contests/abc284/editorial/5481?lang=ja" data-a2a-title="解説 - AtCoder Beginner Contest 284">
	<a class="a2a_button_facebook"></a>
	<a class="a2a_button_twitter"></a>
	
		<a class="a2a_button_hatena"></a>
	
	<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
</div>

		
		<script async src="//static.addtoany.com/menu/page.js"></script>
		
	</div> 
	<hr>
</div> 

	<div class="container" style="margin-bottom: 80px;">
			<footer class="footer">
			
				<ul>
					<li><a href="/contests/abc284/rules">ルール</a></li>
					<li><a href="/contests/abc284/glossary">用語集</a></li>
					
				</ul>
			
			<ul>
				<li><a href="/tos">利用規約</a></li>
				<li><a href="/privacy">プライバシーポリシー</a></li>
				<li><a href="/personal">個人情報保護方針</a></li>
				<li><a href="/company">企業情報</a></li>
				<li><a href="/faq">よくある質問</a></li>
				<li><a href="/contact">お問い合わせ</a></li>
				<li><a href="/documents/request">資料請求</a></li>
			</ul>
			<div class="text-center">
					<small id="copyright">Copyright Since 2012 &copy;<a href="http://atcoder.co.jp">AtCoder Inc.</a> All rights reserved.</small>
			</div>
			</footer>
	</div>
	<p id="fixed-server-timer" class="contest-timer"></p>
	<div id="scroll-page-top" style="display:none;"><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span> ページトップ</div>

</body>
</html>


