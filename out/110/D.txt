p1 , p2 , ..., pk を異なる素数として、
M = pb11 pb22 ...pbkk
と表せたとします。a1 a2 ...aN = M とすると、これらもまた、ある cij が存在して

ai = pc1i1 pc2i2 ...pckik
と表せるはずです。このとき、a′i と a′′i が異なることと、ある j が存在して c′ij と c′′ij が異なることは同値で
す。従って、この問題の答えは、各 bj を c1j , c2j , ..., cN j に c1j + c2j + ... + cN j = bj を満たすように振り分
ける場合の数と一致します。これは j に関して独立に計算でき、各 j についての場合の数は、組み合わせを

comb で表すとすれば、comb(bj + N − 1, bj ) です (直感的には、bj 個のボールを N − 1 個の仕切りでグルー
プ分けするイメージで、ボールか仕切りか定まっていない bj + N − 1 個の連続したオブジェクトから bj 個
の仕切りを選ぶ場合の数です)。よって、答えは

comb(b1 + N − 1, b1 ) × comb(b2 + N − 1, b2 ) × ... × comb(bk + N − 1, bk )
√

となります。時間計算量は、素因数分解に O( M ) かかり、各 bi は bi = O(logM ) で抑えられるので

comb(bj + N − 1, bj ) の計算は bj 回かけたり割ったりすれば O(logM ) で計算でき、k も高々 O(logM ) な
√
√
ので、全体としては O( M + (logM )2 )、すなわち O( M ) になります (実は N によりません)。

6


