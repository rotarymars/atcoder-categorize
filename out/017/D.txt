
問題概要
• 𝑁個あるサプリメントを番号順に摂取する。
• 同じ味のサプリメントを同じ日に摂取することはできません。
• 考えられる組み合わせ数を計算してください。
• 1 ≦ 𝑁(サプリメントの個数) ≦ 100,000
• 1 ≦ 𝑀(色数) ≦ 100,000

部分点解法 (30点)
• この問題は動的計画法を用いて解くことができます。
• dp[i] = (ある日の終了時点で i 番目のサプリメントまでを摂取する組
み合わせ数) と置きます。
• このとき、各dp[i]については、i 以前の dp の値の組み合わせ「例で
見るようにある連続したdpの値の合計」となります。
• これは、i まで食べる日の前日に j まで食べた場合に j 以前の食べ
方がdp[j]通りあることから言えます。
• 例でもわかるように実は条件を満たすj はある連続した領域になりま
す。

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

サプリ2(色2)

サプリ3(色1)

サプリ4(色2)

サプリ5(色2)

1

• この範囲ならば次のdp値に反映できる

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

1

1

サプリ2(色2)

サプリ3(色1)

サプリ4(色2)

サプリ5(色2)

• この範囲ならば次のdp値に反映できる

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

サプリ2(色2)

1

1

2

サプリ3(色1)

サプリ4(色2)

サプリ5(色2)

• この範囲ならば次のdp値に反映できる
(dp[i] が「i 番目までを食べている」ことに注意)

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

サプリ2(色2)

サプリ3(色1)

1

1

2

3

サプリ4(色2)

サプリ5(色2)

• この範囲ならば次のdp値に反映できる
(dp[i] が「i 番目までを食べている」ことに注意)

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

サプリ2(色2)

サプリ3(色1)

サプリ4(色2)

1

1

2

3

5

サプリ5(色2)

• この範囲ならば次のdp値に反映できる
(dp[i] が「i 番目までを食べている」ことに注意)

部分点解法 (30点)
• 例 (上はサプリメント番号と色,下は dp の値)
初日(何も食べ
てない)

サプリ1(色1)

サプリ2(色2)

サプリ3(色1)

サプリ4(色2)

サプリ5(色2)

1

1

2

3

5

5

• このようにすれば、dp[N] が答えとなります。

部分点解法 (30点)
• 判定をする場合は、右端から配列に、その色が登場したという情報
を順に格納していき 2 回登場したら終了するという方針で、各 i につ
いて O(𝑁) で判定できるので、全体で O(𝑁 2 + 𝑀) となります。

満点解法
• 実は、先ほどのdpで足せる区間は、ある連続する区間であるという
ことだけではなく、右端が右に行くにつれて左端が右にしか行かない
ということも成り立ちます。
• そこで、しゃくとり法を用いることができます。
• 各ステップについて、dp の区間を右に更新したら、同じ値が 2 回以
上登場しなくなるまで左端を右に進めるようにします。
• dp の区間の合計も同様にしゃくとり法や累積和を用いて計算できま
す。
• O(𝑁 + 𝑀) で解くことができます。


